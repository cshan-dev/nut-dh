var data = [
	["row","total_bill","tip","sex","smoker","day","time","size"],
	["1",16.99,1.01,"Female","No","Sun","Dinner",2],
	["2",10.34,1.66,"Male","No","Sun","Dinner",3],
	["3",21.01,3.5,"Male","No","Sun","Dinner",3],
	["4",23.68,3.31,"Male","No","Sun","Dinner",2],
];
/*
var utils = $.pivotUtilities;
var heatmap =  utils.renderers["Heatmap"];
var sumOverSum =  utils.aggregators["Sum over Sum"];

$("#output").pivotUI(
  data, {
    rows: ["sex", "smoker"],
    cols: ["day", "time"],
    aggregator: sumOverSum(["tip", "total_bill"]),
    renderer: heatmap
  });
*/
var accessToken = "";
var refreshToken = "";

var clientId = "227H8D";
var clientSecret = "bf884fa120f3142168a098257e34ea13";

function testcalls(){
	$.get('/getHeartRates')
}

//[clientId]:[clientSecret] encoded with Base64
//used in Authoriation header
var clientEncoded = "MjI3SDhEOmJmODg0ZmExMjBmMzE0MjE2OGEwOTgyNTdlMzRlYTEz";

//Not used by Mark in current build
export var getAccessToken = function() {
	console.log("getting access token");
	var xhr = new XMLHttpRequest();
	xhr.onload = function(){
		if (this.status == 200){
			//set tokens
			var res = JSON.parse(this.response);
			accessToken = res.access_token;
			refreshToken = res.refresh_token;
			console.log("tokens set");
		} else {
			console.log(this.status);
			console.log(this);
		}	
	};
	xhr.open("POST", "https://api.fitbit.com/oauth2/token");
	var authCode = window.location.search.substring(1).replace('code=', '');
	xhr.setRequestHeader("Authorization", "Basic " + clientEncoded);
	xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	var params = "client_id=" + clientId + "&grant_type=authorization_code&redirect_uri=http%3A%2F%2Flocalhost:3000%2Fpost%5Ftokens&code=" + authCode;
	xhr.send(params);
	return accessToken;
};

//Not used by Mark in current build
//gets users steps dating back 7 days from today
var getSteps = function(){
	console.log("getting activites");
	var xhr = new XMLHttpRequest();
	xhr.onload = function(){
		if (this.status == 200){
			console.log(this);
			$('#data').html(this.response);
		} else {
			console.log(this);
		}
	};
	xhr.open("GET", "https://api.fitbit.com/1/user/-/activities/steps/date/today/7d.json");
	xhr.setRequestHeader("Authorization", "Bearer " + accessToken);
	xhr.send();
};

$('#getHeart').click(function(){
	var start = "2016-04-16"//$('#start_date').val();
	var end = "2016-04-20"//$('#end_date').val();
	$.get("/getHeart/" + start + "/" + end, function(data){
		console.log(data);
	});
});

$('#getSteps').click(function(){
	var start = "2016-04-16"//$('#start_date').val();
	var end = "2016-04-20"//$('#end_date').val();
	$.get("/getSteps/" + start + "/" + end, function(data){
		console.log(data);
	});
});
$('#getData').click(function(){
	var start = "2016-05-09"//$('#start_date').val();
	var end = "2016-05-10"//$('#end_date').val();
	var interval = "15min"//$('#interval').val();
	console.log("getting data");
	$.get(`/getAllData/${start}/${end}/${interval}`,function(data){// + start + "/" + end + "/" + interval, function(data){
		console.log(data);
		console.log(JSON.stringify(data));
		$("#pivot").pivotUI(data,{cols:data[0]})
			var headers = table_data.shift();
			headers = headers.map((d) => { return {title: d} });
			$("#dataTable").DataTable({
				data: table_data,
				columns: headers
			});
	});
});

export var testTest = function(){
	return 0;
}

var table_data = [["ID","Activity","2016-05-09 00:00:00","2016-05-09 00:15:00","2016-05-09 00:30:00","2016-05-09 00:45:00","2016-05-09 01:00:00","2016-05-09 01:15:00","2016-05-09 01:30:00","2016-05-09 01:45:00","2016-05-09 02:00:00","2016-05-09 02:15:00","2016-05-09 02:30:00","2016-05-09 02:45:00","2016-05-09 03:00:00","2016-05-09 03:15:00","2016-05-09 03:30:00","2016-05-09 03:45:00","2016-05-09 04:00:00","2016-05-09 04:15:00","2016-05-09 04:30:00","2016-05-09 04:45:00","2016-05-09 05:00:00","2016-05-09 05:15:00","2016-05-09 05:30:00","2016-05-09 05:45:00","2016-05-09 06:00:00","2016-05-09 06:15:00","2016-05-09 06:30:00","2016-05-09 06:45:00","2016-05-09 07:00:00","2016-05-09 07:15:00","2016-05-09 07:30:00","2016-05-09 07:45:00","2016-05-09 08:00:00","2016-05-09 08:15:00","2016-05-09 08:30:00","2016-05-09 08:45:00","2016-05-09 09:00:00","2016-05-09 09:15:00","2016-05-09 09:30:00","2016-05-09 09:45:00","2016-05-09 10:00:00","2016-05-09 10:15:00","2016-05-09 10:30:00","2016-05-09 10:45:00","2016-05-09 11:00:00","2016-05-09 11:15:00","2016-05-09 11:30:00","2016-05-09 11:45:00","2016-05-09 12:00:00","2016-05-09 12:15:00","2016-05-09 12:30:00","2016-05-09 12:45:00","2016-05-09 13:00:00","2016-05-09 13:15:00","2016-05-09 13:30:00","2016-05-09 13:45:00","2016-05-09 14:00:00","2016-05-09 14:15:00","2016-05-09 14:30:00","2016-05-09 14:45:00","2016-05-09 15:00:00","2016-05-09 15:15:00","2016-05-09 15:30:00","2016-05-09 15:45:00","2016-05-09 16:00:00","2016-05-09 16:15:00","2016-05-09 16:30:00","2016-05-09 16:45:00","2016-05-09 17:00:00","2016-05-09 17:15:00","2016-05-09 17:30:00","2016-05-09 17:45:00","2016-05-09 18:00:00","2016-05-09 18:15:00","2016-05-09 18:30:00","2016-05-09 18:45:00","2016-05-09 19:00:00","2016-05-09 19:15:00","2016-05-09 19:30:00","2016-05-09 19:45:00","2016-05-09 20:00:00","2016-05-09 20:15:00","2016-05-09 20:30:00","2016-05-09 20:45:00","2016-05-09 21:00:00","2016-05-09 21:15:00","2016-05-09 21:30:00","2016-05-09 21:45:00","2016-05-09 22:00:00","2016-05-09 22:15:00","2016-05-09 22:30:00","2016-05-09 22:45:00","2016-05-09 23:00:00","2016-05-09 23:15:00","2016-05-09 23:30:00","2016-05-09 23:45:00","2016-05-10 00:00:00","2016-05-10 00:15:00","2016-05-10 00:30:00","2016-05-10 00:45:00","2016-05-10 01:00:00","2016-05-10 01:15:00","2016-05-10 01:30:00","2016-05-10 01:45:00","2016-05-10 02:00:00","2016-05-10 02:15:00","2016-05-10 02:30:00","2016-05-10 02:45:00","2016-05-10 03:00:00","2016-05-10 03:15:00","2016-05-10 03:30:00","2016-05-10 03:45:00","2016-05-10 04:00:00","2016-05-10 04:15:00","2016-05-10 04:30:00","2016-05-10 04:45:00","2016-05-10 05:00:00","2016-05-10 05:15:00","2016-05-10 05:30:00","2016-05-10 05:45:00","2016-05-10 06:00:00","2016-05-10 06:15:00","2016-05-10 06:30:00","2016-05-10 06:45:00","2016-05-10 07:00:00","2016-05-10 07:15:00","2016-05-10 07:30:00","2016-05-10 07:45:00","2016-05-10 08:00:00","2016-05-10 08:15:00","2016-05-10 08:30:00","2016-05-10 08:45:00","2016-05-10 09:00:00","2016-05-10 09:15:00","2016-05-10 09:30:00","2016-05-10 09:45:00","2016-05-10 10:00:00","2016-05-10 10:15:00","2016-05-10 10:30:00","2016-05-10 10:45:00","2016-05-10 11:00:00","2016-05-10 11:15:00","2016-05-10 11:30:00","2016-05-10 11:45:00","2016-05-10 12:00:00","2016-05-10 12:15:00","2016-05-10 12:30:00","2016-05-10 12:45:00","2016-05-10 13:00:00","2016-05-10 13:15:00","2016-05-10 13:30:00","2016-05-10 13:45:00","2016-05-10 14:00:00","2016-05-10 14:15:00","2016-05-10 14:30:00","2016-05-10 14:45:00","2016-05-10 15:00:00","2016-05-10 15:15:00","2016-05-10 15:30:00","2016-05-10 15:45:00","2016-05-10 16:00:00","2016-05-10 16:15:00","2016-05-10 16:30:00","2016-05-10 16:45:00","2016-05-10 17:00:00","2016-05-10 17:15:00","2016-05-10 17:30:00","2016-05-10 17:45:00","2016-05-10 18:00:00","2016-05-10 18:15:00","2016-05-10 18:30:00","2016-05-10 18:45:00","2016-05-10 19:00:00","2016-05-10 19:15:00","2016-05-10 19:30:00","2016-05-10 19:45:00","2016-05-10 20:00:00","2016-05-10 20:15:00","2016-05-10 20:30:00","2016-05-10 20:45:00","2016-05-10 21:00:00","2016-05-10 21:15:00","2016-05-10 21:30:00","2016-05-10 21:45:00","2016-05-10 22:00:00","2016-05-10 22:15:00","2016-05-10 22:30:00","2016-05-10 22:45:00","2016-05-10 23:00:00","2016-05-10 23:15:00","2016-05-10 23:30:00","2016-05-10 23:45:00"],["4K43VK","activities-calories",16.436220169067383,14.021860122680664,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,14.021860122680664,13.928999900817871,13.928999900817871,14.114720344543457,13.928999900817871,13.928999900817871,14.021860122680664,13.928999900817871,13.928999900817871,14.114720344543457,14.021860122680664,15.600480079650879,23.67930030822754,23.493579864501953,26.465099334716797,38.25831985473633,18.57200050354004,23.493579864501953,27.022260665893555,24.42218017578125,33.33673858642578,24.42218017578125,16.90052032470703,16.52907943725586,21.26494026184082,15.971920013427734,22.47212028503418,17.086240768432617,20.243480682373047,22.00782012939453,32.31528091430664,14.671879768371582,33.42959976196289,27.11511993408203,35.10108184814453,32.965301513671875,37.14400100708008,25.536500930786133,47.54431915283203,57.1088981628418,27.672279357910156,36.02967834472656,24.8864803314209,18.01483917236328,33.89390182495117,26.00079917907715,40.67267990112305,33.615318298339844,40.394100189208984,37.05113983154297,36.865421295166016,22.750699996948242,25.722219467163086,22.286399841308594,26.093660354614258,15.971920013427734,18.57200050354004,112.54631805419922,99.26734161376953,27.207979202270508,71.59506225585938,36.02967834472656,18.01483917236328,22.84355926513672,33.42959976196289,40.765541076660156,64.63056182861328,68.34496307373047,22.00782012939453,22.193540573120117,21.822099685668945,20.150619506835938,16.343360900878906,18.57200050354004,27.95085906982422,20.800640106201172,15.507619857788086,21.63637924194336,41.13697814941406,15.879059791564941,14.021860122680664,13.928999900817871,13.928999900817871,14.021860122680664,13.928999900817871,14.021860122680664,14.300439834594727,14.207579612731934,14.114720344543457,13.928999900817871,13.928999900817871,13.928999900817871,14.021860122680664,14.021860122680664,14.021860122680664,13.928999900817871,13.928999900817871,13.928999900817871,14.114720344543457,13.928999900817871,14.114720344543457,14.300439834594727,13.928999900817871,13.928999900817871,13.928999900817871,14.021860122680664,14.114720344543457,14.486160278320312,14.114720344543457,14.114720344543457,21.17207908630371,24.143600463867188,23.772159576416016,21.63637924194336,14.950460433959961,26.557960510253906,27.57942008972168,17.643400192260742,19.129159927368164,23.772159576416016,18.8505802154541,22.657840728759766,25.62936019897461,27.95085906982422,28.229440689086914,17.550540924072266,28.879459381103516,15.043319702148438,26.00079917907715,17.643400192260742,27.11511993408203,24.143600463867188,49.7729606628418,44.387081146240234,34.4510612487793,26.74367904663086,25.443639755249023,21.72924041748047,22.286399841308594,14.579019546508789,32.68672180175781,31.758119583129883,29.715200424194336,36.401119232177734,15.229040145874023,22.47212028503418,27.300840377807617,16.15764045715332,23.122140884399414,31.94384002685547,23.772159576416016,17.643400192260742,16.993379592895508,18.10770034790039,17.086240768432617,37.05113983154297,18.8505802154541,31.850980758666992,13.928999900817871,14.300439834594727,14.39330005645752,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,14.021860122680664,13.928999900817871,42.62274169921875,18.200559616088867,13.928999900817871,15.507619857788086,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871,13.928999900817871],["4K43VK","activities-distance",0.006039999891072512,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.005369999911636114,0.05302000045776367,0.05503999814391136,0.09797000139951706,0.17315000295639038,0.01744999922811985,0.10468000173568726,0.17312000691890717,0.1127299964427948,0.19257999956607819,0.09797000139951706,0.004029999952763319,0.007379999849945307,0.06239999830722809,0.004699999932199717,0.07648999989032745,0.009399999864399433,0.021479999646544456,0.04295000061392784,0.16102999448776245,0,0.13958999514579773,0.11339999735355377,0.18386000394821167,0.11339999735355377,0.08252999931573868,0.04766000062227249,0.25902000069618225,0.353630006313324,0.10266999900341034,0.21404999494552612,0.11810000240802765,0.013419999741017818,0.21404999494552612,0.08053000271320343,0.3214299976825714,0.1456100046634674,0.20937000215053558,0.16708000004291534,0.2516300082206726,0.10131999850273132,0.012090000323951244,0.0637499988079071,0.0697999969124794,0.011409999802708626,0.02215000055730343,1.5239499807357788,0.6207000017166138,0.05705000087618828,0.8434500098228455,0.240229994058609,0.005369999911636114,0.0597199983894825,0.18252000212669373,0.23687000572681427,0.750190019607544,0.8011800050735474,0.087909996509552,0.06577000021934509,0.019460000097751617,0.00803999975323677,0.0033599999733269215,0.014759999699890614,0.06843999773263931,0.06106000021100044,0,0.06241000071167946,0.11274000257253647,0.008050000295042992,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.03288000077009201,0.028179999440908432,0.07515999674797058,0.07113000005483627,0,0.13821999728679657,0.1200999990105629,0,0.007379999849945307,0.05167999863624573,0.014759999699890614,0.016769999638199806,0.10937999933958054,0.08455000072717667,0.1503099948167801,0.006709999870508909,0.14427000284194946,0,0.11541999876499176,0.009399999864399433,0.07514999806880951,0.07180999964475632,0.3603599965572357,0.21875,0.048980001360177994,0.099310003221035,0.10937000066041946,0.06576000154018402,0.0778300017118454,0,0.20802000164985657,0.17445999383926392,0.20869000256061554,0.23419000208377838,0,0.08721999824047089,0.12347999960184097,0,0.06710000336170197,0.1160999983549118,0.04966000095009804,0.004699999932199717,0,0.010739999823272228,0,0.17111000418663025,0.006709999870508909,0.220770001411438,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.18720999360084534,0.04092999920248985,0,0,0,0,0,0,0]];
